# 3Dインタラクション実装メモ

## 移植した機能

1. WebGLマネージャー (クラス `WebGLManager`)
   - シェーダープログラム管理
   - テクスチャ/フレームバッファ管理
   - ユニフォーム変数の設定
   - テクスチャのスワップ処理
   - ブレンドモード制御
   - MVP行列の計算と管理
   - マウスインタラクション処理

2. パーティクルシステム (クラス `ParticleSystem`)
   - デバイス検出とGPU判定
   - パーティクル数の動的調整
   - テクスチャの初期化
   - パーティクルの更新と描画
   - ライフサイクル管理
   - 位置と速度の更新

3. シェーダー
   - 基本頂点シェーダー
   - フラグメントシェーダー（カラー計算）
   - 速度シェーダー（速度場の更新）
   - 圧力シェーダー（圧力場の計算）

## 型安全性の改善

- WebGL関連の型定義追加
- クラスプロパティの private 設定
- メソッドの戻り値型の明示
- デバイス検出の型チェック強化
- シェーダー関連の定数の型定義

## 最適化

- デバイス別のパーティクル数調整
- iOS/iPadOS向けの特別な処理
- ブレンドモードの最適化
- テクスチャのスワップによるメモリ効率化
- 行列計算の最適化

## 元コードからの変更点

- 1ファイルに統合
- TypeScript型定義の追加
- 不要なコードの削除
- シェーダーコードの整理
- クラス構造の改善

## 参照元

- `apps/nh_top/HACK The Nikkei_files/index-91c257438e1e5263.js`
- `apps/nh_rebuild/docs/3d-rendering-technical-spec.md`